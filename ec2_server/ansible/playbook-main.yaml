
- name: Docker installing
  hosts: prod_servers
  become: yes

  tasks:
    - name: Installing Docker
      shell: amazon-linux-extras install -y docker

    - name: Installing Docker-compose
      shell: curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose && curl -L https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose

    - name: change mod
      shell: chmod +x /usr/local/bin/docker-compose

    - name: Start Docker engine
      service: name=docker state=started

    - name: Installing Git
      yum: name=git state=latest

    - name: Adding repo
      copy: src=psql12_repo dest=/etc/yum.repos.d/pgdg.repo

    - name: make cache
      shell: yum makecache

    - name: installig Postgresql12
      yum: name=postgresql12 state=installed

    - name: Create env file
      copy: src=.env dest=/var/.env

    - name: Create .pgpass
      copy: src=.pgpass dest=/home/ec2-user/ mod=600
